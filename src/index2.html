<!DOCTYPE html>
<html>
	<head>
		<title>Controller</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<script>
			var webSocket, selected, code = '';
			function run() { eval(code); code = ''; }
			function startWebSocket()
			{
				webSocket = new WebSocket('ws://192.168.1.6/' + window.location.hostname  + ':81/');

				webSocket.onmessage = function(message)
				{
					if(message.data.charCodeAt(0) == 1) selected = document.body.pageList[parseInt(message.data.substring(1))];
					else if(message.data.charCodeAt(0) == 2)
					{
						var index = parseInt(message.data.substring(1));
						if(selected.childrenList[index] == undefined)
						{
							selected.container.append(selected.childrenList[index] = document.createElement('div'));
							selected.childrenList[index].childrenList = [];
							selected.childrenList[index].container = selected.childrenList[index];
						}
						selected = selected.childrenList[index];
					}
					else if(message.data.charCodeAt(0) == 3) run(code, selected, '', true) //run js code
					else code += message.data; //add js code
				}

				webSocket.onopen = function()
				{
					while(document.body.firstChild) document.body.removeChild(document.body.firstChild);
					document.body.container = document.body;
				}

				webSocket.onclose = webSocket.onerror = function()
				{
					while(document.body.firstChild) document.body.removeChild(document.body.firstChild);
					//create reconnect page
					document.body.innerHTML = "<style>body{display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden;flex-direction:column;}</style>\
<div style='font:bold 50px monospace;margin:10px;color:green;padding:10px 20px;border:5px solid green;\
-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;' onclick='startWebSocket()'>Reconnect</div>";
				}

				while(document.body.firstChild) document.body.removeChild(document.body.firstChild);
				//create connecting page
				document.body.innerHTML = "<style>body{display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden;flex-direction:column;}@keyframes dash{0%,25%{stroke-dashoffset:199.99;}100%{stroke-dashoffset:0;}}</style>\
<svg viewBox='0 0 100 100' style='width:100px;height:100px;stroke-dasharray:200;animation:dash 2s linear alternate infinite;'>\
<path class='path' d='M90 50A40 40 0 1 1 50 10' fill='none' stroke='green'stroke-width='10' stroke-linecap='round'></path>\
<animateTransform attributeName='transform' type='rotate' dur='1s' from='0' to='360' repeatCount='indefinite'></svg><div style='font:bold 50px monospace;margin:10px;color:green;'>Connecting</div>";
			}

			/*
			set controller page
			create.fullscreenButton(); create.controllerSelector(); create.controllerPages();
			run js code

			reset selector
			
			*/
		</script>
	</head>
	<body onload='startWebSocket()'></body>
</html>
